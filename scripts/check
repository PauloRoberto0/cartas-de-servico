#!/bin/bash

set -e -o pipefail

CARTAS_DIR="cartasServico"

if [ ! -d "$CARTAS_DIR" ]; then
  echo "Diretório de cartas de serviço não encontrado em: $(pwd)"
  echo "Script deve ser executado no diretório principal do projeto"
  exit -1
fi

cd "$CARTAS_DIR"

find . -type f -regex ".*/v[0-9]*/[^_].*\.xsd" | while read xsd
do
  xml="${xsd/.xsd/-exemplo.xml}"

  echo -e "\nValidando arquivo ${xml} contra ${xsd}..."
  xmllint --noout --schema "$xsd" "$xml"
done
